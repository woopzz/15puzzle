var g="0123456789ABCDEF",m="F",l=class{constructor(t,n=[]){this.state=t,this.path=n,this.blankTileIndex=t.indexOf(m)}canBeMoved(t){return t<0||t>15?!1:t-4===this.blankTileIndex||t+4===this.blankTileIndex||t-1===this.blankTileIndex&&t%4!==0||t+1===this.blankTileIndex&&t%4!==3}move(t){let n=this.blankTileIndex<t?this.blankTileIndex:t,o=this.blankTileIndex>t?this.blankTileIndex:t;return new l(this.state.slice(0,n)+this.state[o]+this.state.slice(n+1,o)+this.state[n]+this.state.slice(o+1),[...this.path,t])}};function h(e){return e.state===g}function x(e){let t=k(e)&1,n=I(e)&1;return!!(t^n)}function k(e){let t=e.state.indexOf(m);return 4-Math.floor(t/4)}function I(e){let t=0;for(let n=0;n<e.state.length-1;n++)for(let o=n+1;o<e.state.length;o++)e.state[n]!==m&&e.state[o]!==m&&e.state[n]>e.state[o]&&t++;return t}var y=class{constructor(t){this.board=t}execute(){for(;this.shuffle(),!(x(this.board)&&!h(this.board)););return this.board}shuffle(){let t=Array.from(this.board.state);for(let n=t.length-1;n>0;n--){let o=Math.floor(Math.random()*n),r=t[n];t[n]=t[o],t[o]=r}this.board=new l(t.join(""))}};var a,v=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&v.decode();var d=null;function _(){return(d===null||d.byteLength===0)&&(d=new Uint8Array(a.memory.buffer)),d}function S(e,t){return e=e>>>0,v.decode(_().subarray(e,e+t))}var p=0,w=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},R=typeof w.encodeInto=="function"?function(e,t){return w.encodeInto(e,t)}:function(e,t){let n=w.encode(e);return t.set(n),{read:e.length,written:n.length}};function O(e,t,n){if(n===void 0){let c=w.encode(e),f=t(c.length,1)>>>0;return _().subarray(f,f+c.length).set(c),p=c.length,f}let o=e.length,r=t(o,1)>>>0,i=_(),s=0;for(;s<o;s++){let c=e.charCodeAt(s);if(c>127)break;i[r+s]=c}if(s!==o){s!==0&&(e=e.slice(s)),r=n(r,o,o=s+e.length*3,1)>>>0;let c=_().subarray(r+s,r+o),f=R(e,c);s+=f.written,r=n(r,o,s,1)>>>0}return p=s,r}var u=null;function T(){return(u===null||u.byteLength===0)&&(u=new Int32Array(a.memory.buffer)),u}var b=null;function W(){return(b===null||b.byteLength===0)&&(b=new Uint32Array(a.memory.buffer)),b}function D(e,t){return e=e>>>0,W().subarray(e/4,e/4+t)}function E(e){try{let r=a.__wbindgen_add_to_stack_pointer(-16),i=O(e,a.__wbindgen_malloc,a.__wbindgen_realloc),s=p;a.autosolve(r,i,s);var t=T()[r/4+0],n=T()[r/4+1],o=D(t,n).slice();return a.__wbindgen_free(t,n*4,4),o}finally{a.__wbindgen_add_to_stack_pointer(16)}}async function U(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(o){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",o);else throw o}let n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{let n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}function C(){let e={};return e.wbg={},e.wbg.__wbindgen_throw=function(t,n){throw new Error(S(t,n))},e}function F(e,t){return a=e.exports,A.__wbindgen_wasm_module=t,u=null,b=null,d=null,a}async function A(e){if(a!==void 0)return a;typeof e>"u"&&(e=new URL("wasm_15puzzle_bg.wasm",import.meta.url));let t=C();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));let{instance:n,module:o}=await U(await e,t);return F(n,o)}var L=A;var q=new Map([["1","0"],["2","1"],["3","2"],["4","3"],["5","4"],["6","5"],["7","6"],["8","7"],["9","8"],["10","9"],["11","A"],["12","B"],["13","C"],["14","D"],["15","E"],["0","F"]]),N=new Map([["0","1"],["1","2"],["2","3"],["3","4"],["4","5"],["5","6"],["6","7"],["7","8"],["8","9"],["9","10"],["A","11"],["B","12"],["C","13"],["D","14"],["E","15"],["F","0"]]);function H(e,t){let n=document.querySelector(".field"),o=document.querySelector(".won-msg"),r=n.children;for(let i=0;i<e.state.length;i++){let s=r[i];s.dataset.number=N.get(e.state[i]),s.style.backgroundColor=""}if(t.length){let i=r[t.at(-1)];i.style.backgroundColor="#bbb"}o.style.display=h(e)?"block":"none"}var M=()=>new y(new l(g,[])).execute();function B(){let e=M(),t=[],n=()=>H(e,t);document.querySelector(".field").addEventListener("click",function(o){let r=o.target;if(!r.classList.contains("box"))return;let i=q.get(r.dataset.number);if(i===void 0)return;let s=e.state.indexOf(i);e.canBeMoved(s)&&(e=e.move(s)),t.length&&(e.path.length&&e.path.at(-1)===t.at(-1)?t.pop():t=[]),n()}),document.querySelector(".hint").addEventListener("click",function(){t=Array.from(E(e.state)).reverse(),n()}),document.querySelector(".shuffle").addEventListener("click",function(){e=M(),t=[],n()}),n()}L().then(()=>{document.readyState==="loading"?document.addEventListener("DOMContentLoaded",B):B()});
